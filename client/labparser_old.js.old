"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
let parsedData = {
    "targetClipStartsAt": 0,
    "targetClipEndsAt": 140.69055,
    "audioClips": [{
            "name": "A_00_さとうささら.wav",
            "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_00_さとうささら.wav",
            "startSeconds": 0,
            "endSeconds": 2.95295,
            "inPontSeconds": 0,
            "endPontSeconds": 2.95295,
            "duration": 2.95295
        }, {
            "name": "A_01_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_01_さとうささら.wav", "startSeconds": 2.95295, "endSeconds": 8.97563333333333, "inPontSeconds": 0, "endPontSeconds": 6.02268333333333, "duration": 6.02268333333333
        }, {
            "name": "A_02_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_02_さとうささら.wav", "startSeconds": 8.97563333333333, "endSeconds": 14.4477666666667, "inPontSeconds": 0, "endPontSeconds": 5.47213333333333, "duration": 5.47213333333333
        }, { "name": "A_03_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_03_さとうささら.wav", "startSeconds": 20.4370833333333, "endSeconds": 29.1291, "inPontSeconds": 0, "endPontSeconds": 8.69201666666667, "duration": 8.69201666666667 }, { "name": "A_04_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_04_さとうささら.wav", "startSeconds": 29.1291, "endSeconds": 34.6679666666667, "inPontSeconds": 0, "endPontSeconds": 5.53886666666667, "duration": 5.53886666666667 }, { "name": "A_05_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_05_さとうささら.wav", "startSeconds": 35.1684666666667, "endSeconds": 43.6102333333333, "inPontSeconds": 0, "endPontSeconds": 8.44176666666667, "duration": 8.44176666666667 }, { "name": "A_06_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_06_さとうささら.wav", "startSeconds": 43.6102333333333, "endSeconds": 47.2305166666667, "inPontSeconds": 0, "endPontSeconds": 3.62028333333333, "duration": 3.62028333333333 }, { "name": "A_07_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_07_さとうささら.wav", "startSeconds": 47.7310166666667, "endSeconds": 57.7243333333333, "inPontSeconds": 0, "endPontSeconds": 9.99331666666667, "duration": 9.99331666666667 }, { "name": "A_08_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_08_さとうささら.wav", "startSeconds": 58.7253333333333, "endSeconds": 62.3789833333333, "inPontSeconds": 0, "endPontSeconds": 3.65365, "duration": 3.65365 }, { "name": "A_09_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_09_さとうささら.wav", "startSeconds": 62.8794833333333, "endSeconds": 75.5421333333333, "inPontSeconds": 0, "endPontSeconds": 12.66265, "duration": 12.66265 }, { "name": "A_10_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_10_さとうささら.wav", "startSeconds": 76.0426333333333, "endSeconds": 84.2675166666667, "inPontSeconds": 0, "endPontSeconds": 8.22488333333333, "duration": 8.22488333333333 }, { "name": "A_11_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_11_さとうささら.wav", "startSeconds": 85.2685166666667, "endSeconds": 99.9164833333333, "inPontSeconds": 0, "endPontSeconds": 14.6479666666667, "duration": 14.6479666666667 }, { "name": "A_12_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_12_さとうささら.wav", "startSeconds": 100.467033333333, "endSeconds": 111.744966666667, "inPontSeconds": 0, "endPontSeconds": 11.2779333333333, "duration": 11.2779333333333 }, { "name": "A_13_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_13_さとうささら.wav", "startSeconds": 112.729283333333, "endSeconds": 119.936483333333, "inPontSeconds": 0, "endPontSeconds": 7.2072, "duration": 7.2072 }, { "name": "A_14_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_14_さとうささら.wav", "startSeconds": 119.936483333333, "endSeconds": 125.8257, "inPontSeconds": 0, "endPontSeconds": 5.88921666666667, "duration": 5.88921666666667 }, { "name": "A_15_さとうささら.wav", "path": "/Volumes/Samsung_T5/VideoProjects/Travel/002_walking_Hallerbos/Talk/P1/A_15_さとうささら.wav", "startSeconds": 125.8257, "endSeconds": 130.513716666667, "inPontSeconds": 0, "endPontSeconds": 4.68801666666667, "duration": 4.68801666666667 }]
};
function readLineWrapper(rl, x, obj) {
    return new Promise((resolve) => {
        rl.on('line', (str) => {
            //console.log("input: " + str);
            const phoneRecord = str.split(' ');
            //console.log('number of col: ' + phoneRecord.length);
            let phoneStartsAt = parseFloat(phoneRecord[0]);
            let phoneEndsAt = parseFloat(phoneRecord[1]);
            //console.log('phoneStartsAt: ' + phoneRecord.toString() + ', phoneEndsAt: ' + phoneEndsAt.toString());
            if (phoneRecord && phoneRecord.length === 3 ||
                isNaN(phoneStartsAt) && isNaN(phoneEndsAt) &&
                    phoneRecord[2]) {
                const phone = phoneRecord[2];
                let lipShape = '';
                // Correct value by deviding by 10000000
                phoneStartsAt /= 10000000;
                phoneEndsAt /= 10000000;
                // Calculate time based on offset
                let startSeconds = x.startSeconds - obj.targetClipStartsAt + phoneStartsAt;
                let endSeconds = x.endSeconds - obj.targetClipStartsAt + phoneEndsAt;
                //console.log('startSeconds: ' + startSeconds.toString() + ', endSeconds: ' + endSeconds.toString());
                // maps to other sounds (for similar shpae)
                switch (phone) {
                    case "m":
                        lipShape = "N";
                        break;
                    case "p":
                        lipShape = "N";
                        break;
                    case "b":
                        lipShape = "N";
                        break;
                    case "w":
                        lipShape = "o";
                        break;
                    case "pau":
                        lipShape = "N";
                        break;
                    default:
                        lipShape = phone;
                        break;
                }
                var phoneLabel = { startSeconds: startSeconds, endSeconds: endSeconds, phone: phone, lipShape: lipShape };
                //console.log(phoneLabel);
                //console.log("resolved!");
                resolve(phoneLabel);
            }
        });
    });
}
function generateAeJson(json) {
    return __awaiter(this, void 0, void 0, function* () {
        //return "test";
        let response = { phoneLabels: [] };
        if (json.length === 0) {
            return "";
        }

        return "aaaa";


        // const path = cep_node.require('path');
        // const fs = cep_node.require('fs');
        // const readline = cep_node.require('readline');
        // let obj = JSON.parse(json);
        // for (let x of obj.audioClips) {
        //     let filePath = path.dirname(x.path) + '/' + path.basename(x.path, '.wav') + '.lab';
        //     //console.log("file name: " + filePath)
        //     const rs = fs.createReadStream(filePath);
        //     const rl = readline.createInterface({
        //         input: rs
        //     });
        //     //console.log("main");
        //     ///loop
        //     const result = yield readLineWrapper(rl, x, obj);
        //     //console.log("readLineWrapperFinished!");
        //     response.phoneLabels.push(result);
        //     //console.log("line result: " + JSON.stringify(result));
        // }


        //console.log('audio clips loop finished!');
        //console.log(JSON.stringify(response.phoneLabels));
        return JSON.stringify(response);
    });
}
function main() {
    return __awaiter(this, void 0, void 0, function* () {
        //console.log("aaana");
        const result = yield generateAeJson(JSON.stringify(parsedData));
        console.log("generate AE JSON result: " + result);
        console.log("all process finished");
    });
}
//main();
